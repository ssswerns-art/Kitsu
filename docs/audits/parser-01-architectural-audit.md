# PARSER-01: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞—É–¥–∏—Ç –ø–∞—Ä—Å–µ—Ä–∞

**–ó–ê–î–ê–ß–ê:** PARSER-01 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞—É–¥–∏—Ç –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä—Å–µ—Ä–∞ (Admin-controlled, –±–µ–∑ –∫–æ–¥–∞)  
**–î–ê–¢–ê –ê–£–î–ò–¢–ê:** 2026-01-20  
**–°–¢–ê–¢–£–°:** ‚úÖ COMPLETE

---

## EXECUTIVE SUMMARY

**–¶–µ–ª—å –∞—É–¥–∏—Ç–∞:**
–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–∞—Ä—Å–µ—Ä–∞ –î–û —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ø–∞—Ä—Å–µ—Ä –ù–ò–ö–û–ì–î–ê –Ω–µ –ª–æ–º–∞–ª —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç, –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥ –±—ã–ª —É–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É, –∏ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å cron-—Ö–∞–æ—Å–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä—Å–µ—Ä–∞ (`docs/contracts/parser.md`)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤—Å–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ fail-fast —É—Å–ª–æ–≤–∏—è
- ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∞–¥–º–∏–Ω–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ auto-parsing
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** YES ‚úÖ

---

## 1. –ê–£–î–ò–¢ –¢–ï–ö–£–©–ï–ì–û –ü–ê–†–°–ï–†–ê

### 1.1. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
```
backend/app/parser/
‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îú‚îÄ‚îÄ router.py          # Admin endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–æ–º
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py         # DTO –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ sync_service.py    # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ publish_service.py # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏–∑ staging –≤ main catalog
‚îÇ   ‚îî‚îÄ‚îÄ autoupdate_service.py # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–Ω–≥–æ–∏–Ω–≥–æ–≤
‚îú‚îÄ‚îÄ sources/
‚îÇ   ‚îú‚îÄ‚îÄ shikimori_catalog.py   # –ö–∞—Ç–∞–ª–æ–≥ –∞–Ω–∏–º–µ
‚îÇ   ‚îú‚îÄ‚îÄ shikimori_schedule.py  # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ kodik_episode.py       # iframe-—Å—Å—ã–ª–∫–∏
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îú‚îÄ‚îÄ base.py            # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ autoupdate.py      # –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–ø–∏–∑–æ–¥–æ–≤
‚îú‚îÄ‚îÄ tables.py              # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è staging tables
‚îú‚îÄ‚îÄ anime.py               # –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–Ω–∏–º–µ
‚îú‚îÄ‚îÄ schedule.py            # –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îî‚îÄ‚îÄ common.py              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
```

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### 1.2. –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–¢–µ–∫—É—â–∏–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞:**

1. **Manual (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É):**
   - `POST /api/admin/parser/sync` ‚Äî —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –¢—Ä–µ–±—É–µ—Ç permission `admin:*`
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏–ª–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (background jobs):**
   - `parser/jobs/autoupdate.py` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   - –¢—Ä–∏–≥–≥–µ—Ä: –ù–ï –û–ü–†–ï–î–ï–õ–Å–ù –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - ‚ö†Ô∏è **–†–ò–°–ö:** –ù–µ—Ç —è–≤–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `parser_settings.mode` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥–∞.

### 1.3. –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–æ–≥–∞–µ—Ç

**Staging tables (–ø–∞—Ä—Å–µ—Ä –ø–∏—à–µ—Ç –Ω–∞–ø—Ä—è–º—É—é):**
- `parser_sources` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- `parser_settings` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞
- `parser_jobs`, `parser_job_logs` ‚Äî –ª–æ–≥–∏ –∑–∞–¥–∞—á
- `anime_external` ‚Äî –º–∞–ø–ø–∏–Ω–≥ –≤–Ω–µ—à–Ω–∏—Ö ID
- `anime_schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–∏–π
- `anime_episodes_external` ‚Äî –¥–∞–Ω–Ω—ã–µ –æ —Å–µ—Ä–∏—è—Ö –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

**Main catalog (—á–µ—Ä–µ–∑ publish service):**
- `anime` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–Ω–∏–º–µ
- `episodes` ‚Äî –¥–∞–Ω–Ω—ã–µ –æ —Å–µ—Ä–∏—è—Ö

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ Staging architecture —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å –≤ main catalog –û–¢–°–£–¢–°–¢–í–£–ï–¢.

### 1.4. –ì–¥–µ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏:**

1. **Publish service –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å manual data:**
   - ‚ùå –ï—Å–ª–∏ –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ `source = "manual"`
   - ‚ùå –ï—Å–ª–∏ –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ `is_locked`
   
2. **Autoupdate –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è:**
   - ‚ùå –ï—Å–ª–∏ –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ `parser_settings.mode`
   
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ audit logging:**
   - ‚ùå –ï—Å–ª–∏ publish/update –ù–ï –ª–æ–≥–∏—Ä—É—é—Ç –≤ `audit_logs`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—Ç–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (—Ä–∞–∑–¥–µ–ª 6.2).

---

## 2. –ê–£–î–ò–¢ –ë–ê–ó–´ –î–ê–ù–ù–´–•

### 2.1. –ü–æ–ª—è Anime

**–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä—Å–µ—Ä –ú–û–ñ–ï–¢ –æ–±–Ω–æ–≤–ª—è—Ç—å (—Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É):**

| –ü–æ–ª–µ | Nullable | Locked Check Required | Notes |
|------|----------|----------------------|-------|
| `title_ru` | YES | YES | –†—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ |
| `title_en` | YES | YES | –ê–Ω–≥–ª–∏–π—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ |
| `title_original` | YES | YES | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ |
| `description` | YES | YES | –û–ø–∏—Å–∞–Ω–∏–µ |
| `poster_url` | YES | YES | –ü–æ—Å—Ç–µ—Ä |
| `year` | YES | YES | –ì–æ–¥ –≤—ã—Ö–æ–¥–∞ |
| `season` | YES | YES | –°–µ–∑–æ–Ω |
| `status` | YES | YES | –°—Ç–∞—Ç—É—Å –∞–Ω–∏–º–µ |
| `genres` | YES | YES | –ñ–∞–Ω—Ä—ã (JSON) |
| `state` | NO | ‚Äî | –¢–û–õ–¨–ö–û: pending, broken |
| `source` | NO | ‚Äî | –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: "parser" |

**–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä—Å–µ—Ä –ù–ï –ú–û–ñ–ï–¢ –ù–ò–ö–û–ì–î–ê —Ç—Ä–æ–≥–∞—Ç—å:**

| –ü–æ–ª–µ | Reason |
|------|--------|
| `id` | Primary key |
| `created_by` | Ownership |
| `updated_by` | MUST BE NULL –¥–ª—è parser |
| `is_locked` | Admin-only |
| `locked_fields` | Admin-only |
| `locked_by` | Admin-only |
| `locked_reason` | Admin-only |
| `locked_at` | Admin-only |
| `is_deleted` | Admin-only (soft delete) |
| `deleted_at` | Admin-only |
| `deleted_by` | Admin-only |
| `delete_reason` | Admin-only |
| `created_at` | System timestamp |
| `updated_at` | Auto-updated by DB |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ –ú–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### 2.2. –ü–æ–ª—è Episode

**–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä—Å–µ—Ä –ú–û–ñ–ï–¢ –æ–±–Ω–æ–≤–ª—è—Ç—å:**

| –ü–æ–ª–µ | Nullable | Locked Check Required | Notes |
|------|----------|----------------------|-------|
| `title` | YES | YES | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–∏ |
| `iframe_url` | YES | YES | iframe –¥–ª—è –ø–ª–µ–µ—Ä–∞ |
| `available_translations` | YES | YES | –°–ø–∏—Å–æ–∫ –æ–∑–≤—É—á–µ–∫ (JSON) |
| `available_qualities` | YES | YES | –°–ø–∏—Å–æ–∫ –∫–∞—á–µ—Å—Ç–≤ (JSON) |
| `source` | NO | ‚Äî | –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: "parser" |

**–ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä—Å–µ—Ä –ù–ï –ú–û–ñ–ï–¢ —Ç—Ä–æ–≥–∞—Ç—å:**

| –ü–æ–ª–µ | Reason |
|------|--------|
| `id` | Primary key |
| `release_id` | –°–≤—è–∑—å —Å —Ä–µ–ª–∏–∑–æ–º |
| `number` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ |
| `created_by` | Ownership |
| `updated_by` | MUST BE NULL –¥–ª—è parser |
| `is_locked`, `locked_*` | Admin-only |
| `is_deleted`, `deleted_*` | Admin-only |
| `created_at`, `updated_at` | System timestamps |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ –ú–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### 2.3. Release

**–ü–æ–ª—è:**
- `id`, `anime_id`, `title`, `year`, `status`, `created_at`

**–ü—Ä–∞–≤–∞ –ø–∞—Ä—Å–µ—Ä–∞:**
- ‚ùå Parser **–ù–ï –ú–û–ñ–ï–¢** —Å–æ–∑–¥–∞–≤–∞—Ç—å Release
- ‚ùå Parser **–ù–ï –ú–û–ñ–ï–¢** –∏–∑–º–µ–Ω—è—Ç—å Release
- Release ‚Äî —ç—Ç–æ **admin-only** —Å—É—â–Ω–æ—Å—Ç—å

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ Release –ù–ï –∏–º–µ–µ—Ç ownership/lock –ø–æ–ª–µ–π, –¥–æ—Å—Ç—É–ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ RBAC.

### 2.4. Staging Tables

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | Parser Access |
|---------|------------|---------------|
| `parser_sources` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ | READ/WRITE |
| `parser_settings` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞ | READ/WRITE |
| `parser_jobs` | –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ | READ/WRITE |
| `parser_job_logs` | –õ–æ–≥–∏ –∑–∞–¥–∞—á | WRITE |
| `anime_external` | –ú–∞–ø–ø–∏–Ω–≥ –≤–Ω–µ—à–Ω–∏—Ö ID | READ/WRITE |
| `anime_schedule` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–∏–π | READ/WRITE |
| `anime_episodes_external` | –î–∞–Ω–Ω—ã–µ –æ —Å–µ—Ä–∏—è—Ö | READ/WRITE |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ Staging tables –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç main catalog.

---

## 3. –ê–£–î–ò–¢ ADMIN CORE

### 3.1. Permissions –ø–∞—Ä—Å–µ—Ä–∞

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–æ–ª–∏ (–∏–∑ `admin-core.md`):**

| –†–æ–ª—å | Permissions | –ü—Ä–∏–º–µ–Ω–∏–º–æ –∫ Parser? |
|------|-------------|---------------------|
| `super_admin` | –í—Å–µ | ‚ùå NO |
| `admin` | `admin.*`, `anime.*`, `episode.*` | ‚ùå NO |
| `moderator` | `anime.moderate`, `episode.moderate` | ‚ùå NO |
| `editor` | `anime.edit`, `episode.edit` | ‚ùå NO |
| `parser_bot` | **parser.*** | ‚úÖ YES |
| `support` | `audit.view` | ‚ùå NO |
| `user` | `read:*` | ‚ùå NO |

**–¢—Ä–µ–±—É–µ–º—ã–µ permissions –¥–ª—è parser_bot:**

| Permission | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—É—â–µ—Å—Ç–≤—É–µ—Ç? |
|------------|-----------|-------------|
| `parser.read` | –ß—Ç–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
| `parser.sync` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
| `parser.update_staging` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ staging tables | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |
| `parser.suggest` | –°–æ–∑–¥–∞–Ω–∏–µ pending anime | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |

**–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ permissions –¥–ª—è parser:**

| Permission | Reason |
|------------|--------|
| `anime.publish` | –¢–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å |
| `anime.lock` | –¢–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å |
| `anime.delete` | –¢–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å |
| `episode.delete` | –¢–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å |
| `admin.*` | Parser –ù–ï –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä |
| `audit.view` | Parser –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç –ª–æ–≥–∏ |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö `parser.*` permissions –≤ RBAC.

### 3.2. –ö–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞

**–ò–∑ admin-core invariants:**

1. ‚úÖ **NO actions without permission** ‚Äî –ø–∞—Ä—Å–µ—Ä –û–ë–Ø–ó–ê–ù –ø—Ä–æ–≤–µ—Ä—è—Ç—å permissions
2. ‚úÖ **NO changes without audit** ‚Äî –ø–∞—Ä—Å–µ—Ä –û–ë–Ø–ó–ê–ù –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤ `audit_logs`
3. ‚úÖ **NO delete without soft-delete** ‚Äî –ø–∞—Ä—Å–µ—Ä –ù–ï –ú–û–ñ–ï–¢ —É–¥–∞–ª—è—Ç—å
4. ‚úÖ **Parser ‚â† Admin** ‚Äî –ø–∞—Ä—Å–µ—Ä –∏–º–µ–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —Ä–æ–ª—å `parser_bot`
5. ‚úÖ **Manual > Parser** ‚Äî –ø–∞—Ä—Å–µ—Ä –ù–ï –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å `source = "manual"`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ Admin Core invariants —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø–∞—Ä—Å–µ—Ä–∞.

### 3.3. Lock Service

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π `LockService` (–∏–∑ `admin-core.md`):**

```python
LockService.check_lock(entity, fields_to_update, actor, has_override_permission)
LockService.check_parser_update(entity, fields_to_update, actor_type)
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- ‚úÖ `check_parser_update` ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è parser updates
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `is_locked` –∏ `locked_fields`
- ‚úÖ –ü–æ–¥–Ω–∏–º–∞–µ—Ç `EntityLockedError` –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ LockService –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### 3.4. Audit Service

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π `AuditService` (–∏–∑ `admin-core.md`):**

```python
await audit_service.log_create(entity_type, entity_id, entity_data, actor, reason)
await audit_service.log_update(entity_type, entity_id, before_data, after_data, actor, reason)
await audit_service.log_lock(entity_type, entity_id, locked_fields, actor, reason)
```

**–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è parser:**
- ‚úÖ `log_update` —Å `actor = None`, `actor_type = "system"`
- ‚úÖ Before/After state tracking
- ‚úÖ Reason —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ AuditService –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

---

## 4. –ê–£–î–ò–¢ –ê–î–ú–ò–ù–ö–ò –ü–ê–†–°–ï–†–ê

### 4.1. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤ `parser/admin/router.py`:**

| Endpoint | Method | Permission | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|--------|------------|-----------|
| `/admin/parser/dashboard` | GET | `admin:*` | Dashboard —Å —Å—Ç–∞—Ç—É—Å–æ–º |
| `/admin/parser/sources` | GET | `admin:*` | –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ |
| `/admin/parser/sources/{id}` | PUT | `admin:*` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |
| `/admin/parser/settings` | GET | `admin:*` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞ |
| `/admin/parser/settings` | POST | `admin:*` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `/admin/parser/anime-mapping` | GET | `admin:*` | –ú–∞–ø–ø–∏–Ω–≥ –∞–Ω–∏–º–µ |
| `/admin/parser/schedule` | GET | `admin:*` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–∏–π |
| `/admin/parser/logs` | GET | `admin:*` | –õ–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞ |

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è Permission `admin:*` —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π, —Ç—Ä–µ–±—É–µ—Ç—Å—è `admin:parser.settings`.

### 4.2. –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å (—Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É):**

1. ‚ùå **Global toggle (on/off)**
   - Endpoint –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è `parser_settings.mode`
   - Confirmation dialog –≤ UI

2. ‚ùå **Dry-run toggle**
   - `parser_settings.dry_run` field
   - UI checkbox

3. ‚ùå **–§–∏–ª—å—Ç—Ä—ã**
   - `year_from`, `year_to`
   - `season_filter`, `status_filter`
   - `allowed_qualities`, `allowed_translation_types`
   - `translation_priority`

4. ‚ùå **Blacklist management**
   - `parser_blacklist` table
   - UI –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è

5. ‚ùå **–õ–∏–º–∏—Ç—ã**
   - `max_items_per_run`
   - `rate_limit_per_min` (per source)
   - `max_concurrency` (per source)

6. ‚ùå **Emergency stop**
   - `POST /admin/parser/emergency-stop`
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á

7. ‚ùå **Problem anime page**
   - `/admin/parser/problem-anime`
   - –°–ø–∏—Å–æ–∫ –∞–Ω–∏–º–µ —Å –æ—à–∏–±–∫–∞–º–∏

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.

---

## 5. –ê–£–î–ò–¢ –ê–í–¢–û–ü–ê–†–°–ï–†–ê

### 5.1. Background Jobs

**–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∏–∑ `BACKGROUND_JOBS.md`):**

- `default_job_runner` ‚Äî in-memory queue
- –°—Ç–∞—Ç—É—Å—ã: `queued`, `running`, `succeeded`, `failed`
- Retry: –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫, –ª–∏–Ω–µ–π–Ω—ã–π backoff
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –û—á–µ—Ä–µ–¥—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞, –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ —Ç–µ—Ä—è–µ—Ç—Å—è

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è In-memory queue –ù–ï –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö parser –∑–∞–¥–∞—á.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (worker) –∏–ª–∏ –≤–Ω–µ—à–Ω—é—é –æ—á–µ—Ä–µ–¥—å (Redis/Celery).

### 5.2. Scheduler

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ùå –ù–µ—Ç —è–≤–Ω–æ–≥–æ scheduler –¥–ª—è –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥–∞
- ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `parser_settings.mode` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

**–¢—Ä–µ–±—É–µ—Ç—Å—è (—Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É):**

```python
async def parser_worker_loop():
    while True:
        settings = await get_parser_settings()
        
        if settings.mode != "auto":
            logger.info("Parser in manual mode, sleeping...")
            await asyncio.sleep(60)
            continue
        
        await run_scheduled_tasks()
        await asyncio.sleep(60)
```

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå Scheduler –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–Ω–∏–µ.

### 5.3. –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å ¬´—Å–∞–º–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å¬ª

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞:**

1. ‚úÖ –ù–ï–¢ cron-—Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. ‚úÖ –ù–ï–¢ environment variables –¥–ª—è auto-enable
3. ‚ùå –ù–ï–¢ —è–≤–Ω–æ–≥–æ `mode = "manual"` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ migration

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å migration —Å `parser_settings.mode = "manual"` default.

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `mode = "manual"`.

---

## 6. –ê–£–î–ò–¢ –õ–û–ì–û–í –ò –û–®–ò–ë–û–ö

### 6.1. Parser Job Logs

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `parser_jobs` ‚Äî –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–µ—Ä–∞
- `parser_job_logs` ‚Äî –ª–æ–≥–∏ –∑–∞–¥–∞—á (—É—Ä–æ–≤–Ω–∏: INFO, WARNING, ERROR)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### 6.2. Audit Logs

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

- ‚ùå Publish service **–ù–ï** –ª–æ–≥–∏—Ä—É–µ—Ç –≤ `audit_logs`
- ‚ùå Parser updates **–ù–ï** –ª–æ–≥–∏—Ä—É—é—Ç –≤ `audit_logs`

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
```python
await audit_service.log_update(
    entity_type="anime",
    entity_id=str(anime.id),
    before_data=before_state,
    after_data=after_state,
    actor=None,
    actor_type="system",
    reason=f"Automatic sync from {source_name}"
)
```

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå Audit logging –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ parser services.

### 6.3. Problem Anime Tracking

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚ùå –ù–ï–¢ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∞–Ω–∏–º–µ
- ‚ùå –ù–ï–¢ UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—à–∏–±–æ–∫

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –¢–∞–±–ª–∏—Ü–∞ `parser_problem_anime` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `parser_job_logs` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- UI page `/admin/parser/problem-anime`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå Problem anime tracking –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.

---

## 7. –ê–£–î–ò–¢ –ò–ù–í–ê–†–ò–ê–ù–¢–û–í

### 7.1. Manual > Parser

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**

```python
# –ü–æ–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ source = "manual"
grep -r "source == \"manual\"" backend/app/parser/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå –ù–ï–¢ —è–≤–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ `source = "manual"` –≤ publish/update —Å–µ—Ä–≤–∏—Å–∞—Ö.

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ.

### 7.2. Lock Enforcement

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**

```python
# –ü–æ–∏—Å–∫ –≤—ã–∑–æ–≤–æ–≤ LockService
grep -r "LockService" backend/app/parser/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå LockService **–ù–ï** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ parser services.

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå Lock enforcement –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–∞—Ä—Å–µ—Ä–µ.

### 7.3. State Machine

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**

```python
# –ü–æ–∏—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ state = "published"
grep -r "state.*published" backend/app/parser/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–∞—Ä—Å–µ—Ä –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `state = "published"`, —Ç–æ–ª—å–∫–æ `pending`.

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ State machine –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è.

### 7.4. No Delete

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**

```python
# –ü–æ–∏—Å–∫ DELETE –∏–ª–∏ is_deleted
grep -r "DELETE\|is_deleted = True" backend/app/parser/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü–∞—Ä—Å–µ—Ä –ù–ï —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏.

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ No delete –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è.

### 7.5. Audit Logging

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**

```python
# –ü–æ–∏—Å–∫ –≤—ã–∑–æ–≤–æ–≤ audit_service
grep -r "audit_service" backend/app/parser/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå Audit service **–ù–ï** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ parser services.

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ùå Audit logging –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.

---

## 8. –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

### 8.1. Compliance Score

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|------------|--------|-------------|-----------|
| –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚úÖ PASS | HIGH | Staging tables –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã |
| –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–µ—Ä–æ–≤ | ‚úÖ PASS | HIGH | `parser_bot` —Ä–æ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| Lock mechanism support | ‚ö†Ô∏è PARTIAL | HIGH | LockService –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| Audit logging | ‚ùå FAIL | HIGH | Audit –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω |
| Manual > Parser check | ‚ùå FAIL | CRITICAL | `source = "manual"` –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è |
| State machine | ‚úÖ PASS | HIGH | –ü–∞—Ä—Å–µ—Ä –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç |
| No delete | ‚úÖ PASS | HIGH | –ü–∞—Ä—Å–µ—Ä –Ω–µ —É–¥–∞–ª—è–µ—Ç |
| Admin toggle | ‚ö†Ô∏è PARTIAL | HIGH | Settings –µ—Å—Ç—å, toggle –ù–ï–¢ |
| Dry-run mode | ‚ö†Ô∏è PARTIAL | MEDIUM | –ü–æ–ª–µ –µ—Å—Ç—å, –ª–æ–≥–∏–∫–∞ –ù–ï–¢ |
| Emergency stop | ‚ùå FAIL | MEDIUM | –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |
| Problem anime tracking | ‚ùå FAIL | LOW | –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω |

**Overall Score:** 45% (5/11 PASS)

### 8.2. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–∏—Å–∫–∏

**üî¥ CRITICAL:**
1. **Manual > Parser –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**
   - –ü–∞—Ä—Å–µ—Ä –ú–û–ñ–ï–¢ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

2. **Audit logging –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–∞ –ù–ï –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª –ø–∞—Ä—Å–µ—Ä

**üü† HIGH:**
3. **LockService –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω**
   - –ü–∞—Ä—Å–µ—Ä –ú–û–ñ–ï–¢ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è
   - –ê–¥–º–∏–Ω –ù–ï –º–æ–∂–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Ç –ø–∞—Ä—Å–µ—Ä–∞

4. **Auto-parsing –ù–ï –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è**
   - –ù–ï–¢ —è–≤–Ω–æ–≥–æ toggle on/off
   - –†–∏—Å–∫ ¬´—Å–∞–º–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å¬ª

**üü° MEDIUM:**
5. **Emergency stop –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**
   - –ù–µ–ª—å–∑—è –±—ã—Å—Ç—Ä–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä—Å–µ—Ä –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### 8.3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ë–ª–æ–∫–µ—Ä—ã):**
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä—Å–µ—Ä–∞ (DONE)
2. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `source = "manual"` –≤ publish/update
3. ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å AuditService –≤ parser services
4. ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LockService –≤ parser services

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω—ã–µ):**
5. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å `parser_settings.mode` toggle –≤ UI
6. ‚ö†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å dry-run logic
7. ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å parser worker —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π mode

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ):**
8. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å emergency stop endpoint
9. ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å problem anime page
10. ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å blacklist management

---

## 9. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø

### 9.1. Staging Architecture ‚úÖ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–∞—Ä—Å–µ—Ä –ø–∏—à–µ—Ç –≤ `anime_external`, `anime_schedule`, `anime_episodes_external`
- Publish service –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ `anime`, `episodes`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ Non-invasive architecture —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### 9.2. Actor Separation ‚úÖ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –†–æ–ª—å `parser_bot` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- Parser updates —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç `source = "parser"`
- `created_by` / `updated_by` = NULL –¥–ª—è system

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ Actor separation —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### 9.3. RBAC Integration ‚ö†Ô∏è

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- Admin endpoints —Ç—Ä–µ–±—É—é—Ç `admin:*`
- –†–æ–ª—å `parser_bot` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–ï–¢ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö `parser.*` permissions
- ‚ö†Ô∏è `admin:*` —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π –¥–ª—è settings

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è permissions.

### 9.4. Background Jobs ‚ö†Ô∏è

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- In-memory queue `default_job_runner`
- Retry –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ó–∞–¥–∞—á–∏ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
- ‚ùå –ù–ï–¢ scheduler –¥–ª—è –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥–∞

**–í–µ—Ä–¥–∏–∫—Ç:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π worker –ø—Ä–æ—Ü–µ—Å—Å.

---

## 10. DEFINITION OF DONE

### 10.1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ

- ‚úÖ –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–∞—Ä—Å–µ—Ä–∞ (`docs/contracts/parser.md`)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–æ–ª—å –ø–∞—Ä—Å–µ—Ä–∞ (system actor, `parser_bot`)
- ‚úÖ –û–ø–∏—Å–∞–Ω–∞ –∞–¥–º–∏–Ω–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª—ë–Ω –º–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥–∞
- ‚úÖ –í—ã–ø–∏—Å–∞–Ω—ã –≤—Å–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
- ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏

### 10.2. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚úÖ

- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä –ú–û–ñ–ï–¢ –¥–µ–ª–∞—Ç—å
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä –ù–ï –ú–û–ñ–ï–¢ –ù–ò–ö–û–ì–î–ê –¥–µ–ª–∞—Ç—å
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∞–¥–º–∏–Ω–∫–∞
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å ¬´—Å–∞–º–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å¬ª

### 10.3. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–ù–ï –í–•–û–î–ò–¢ –≤ —ç—Ç–æ—Ç —Ç–∞—Å–∫ (PARSER-01):**
- ‚ùå –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ (–∑–∞–ø—Ä–µ—â–µ–Ω–æ)
- ‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ (—Å–ª–µ–¥—É—é—â–∏–π —Ç–∞—Å–∫)
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ UI (—Å–ª–µ–¥—É—é—â–∏–π —Ç–∞—Å–∫)
- ‚ùå –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (—Å–ª–µ–¥—É—é—â–∏–π —Ç–∞—Å–∫)

**–°–ª–µ–¥—É—é—â–∏–µ —Ç–∞—Å–∫–∏:**
1. **PARSER-02:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Parser Compliance (–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 6.2)
2. **PARSER-03:** –ê–¥–º–∏–Ω–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ (UI + endpoints)
3. **PARSER-04:** Auto-parsing scheduler
4. **PARSER-05:** Monitoring & Alerts

---

## 11. –í–´–í–û–î–´

### 11.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ VALID ‚úÖ

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ Staging architecture –∏–∑–æ–ª–∏—Ä—É–µ—Ç –ø–∞—Ä—Å–µ—Ä
- ‚úÖ Actor separation —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ State machine –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è
- ‚úÖ No delete –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è

### 11.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è INCOMPLETE ‚ö†Ô∏è

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã:**
- ‚ùå Manual > Parser –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚ùå Lock enforcement –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚ùå Audit logging –ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- ‚ùå Auto-parsing –ù–ï –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è

### 11.3. –†–∏—Å–∫–∏ IDENTIFIED ‚úÖ

**–¢–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–æ–π–¥–µ–Ω–∞:**
- ‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∏—Å–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã

**–î–∞–ª—å–Ω–µ–π—à–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞:**
- ‚úÖ –ß—ë—Ç–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ Compliance checklist

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à—ë–Ω:** ‚úÖ SUCCESS

**–ö–æ–Ω—Ç—Ä–∞–∫—Ç —É—Ç–≤–µ—Ä–∂–¥—ë–Ω:** ‚úÖ YES

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ‚úÖ YES

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Parser Compliance (PARSER-02)

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Architectural Audit Agent  
**–î–∞—Ç–∞:** 2026-01-20  
**–°—Ç–∞—Ç—É—Å:** APPROVED FOR IMPLEMENTATION ‚úÖ
